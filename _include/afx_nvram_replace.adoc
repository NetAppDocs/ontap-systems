The NVRAM module consists of the NVRAM12 hardware and field-replaceable DIMMs. You can replace a failed NVRAM module or the DIMMs inside the NVRAM module. 

.Before you begin
* Make sure you have the replacement part available. You must replace the failed component with a replacement component you received from NetApp.

* Make sure all other components in the storage system are functioning properly; if not, contact https://support.netapp.com[NetApp support].


== Step 1: Shut down the impaired controller

Shut down or take over the impaired controller.

include::../_include/shutdown_most_frus_afx.adoc[]

== Step 2: Replace the NVRAM module or NVRAM DIMM

Replace the NVRAM module or NVRAM DIMMs using the appropriate following option.

// start tabbed area

[role="tabbed-block"]
====

.Option 1: Replace the NVRAM module
--

To replace the NVRAM module, locate it in slot 4/5 in the enclosure and follow the specific sequence of steps.

. If you are not already grounded, properly ground yourself.
. Unplug the power supply cables from the PSUs from the controller.
. Rotate the cable management tray down by gently pulling the pins on the ends of the tray and rotating the tray down.
. Remove the impaired NVRAM module from the enclosure:
 .. Depress the locking cam button.
+
The cam button moves away from the enclosure.

 .. Rotate the cam latch down as far as it will go.
+
 .. Remove the impaired NVRAM module from the enclosure by hooking your finger into the cam lever opening and pulling the module out of the enclosure.
+
image::../media/drw_a1k_nvram12_remove_replace_ieops-1380.svg[Remove the NVRAM12 module and DIMMs]
+
[cols="1,4"]
|===
a|
image:../media/icon_round_1.png[Callout number 1] |
Cam locking button
a|
image:../media/icon_round_2.png[Callout number 2] 
a|
DIMM locking tabs
|===

. Set the NVRAM module on a stable surface.
. Remove the DIMMs, one at a time, from the impaired NVRAM module and install them in the replacement NVRAM module.
. Install the replacement NVRAM module into the enclosure:
 .. Align the module with the edges of the enclosure opening in slot 4/5.
 .. Gently slide the module into the slot all the way, and then rotate the cam latch all the way up to lock the module in place.
. Rotate the cable management tray up to the closed position.

--
.Option 2: Replace the NVRAM DIMM
--

To replace NVRAM DIMMs in the NVRAM module, you must remove the NVRAM module, and then replace the target DIMM.

. If you are not already grounded, properly ground yourself.
. Unplug the power supply cables from the PSUs.
. Rotate the cable management tray down by gently pulling the pins on the ends of the tray and rotating the tray down.
. Remove the target NVRAM module from the enclosure.
+
image::../media/drw_a1k_nvram12_remove_replace_ieops-1380.svg[Remove the NVRAM 12 module and DIMMs]
+
[cols="1,4"]
|===
a|
image:../media/icon_round_1.png[Callout number 1] |
Cam locking button
a|
image:../media/icon_round_2.png[Callout number 2] 
a|
DIMM locking tabs
|===

. Set the NVRAM module on a stable surface.
. Locate the DIMM to be replaced inside the NVRAM module.

+
NOTE: Consult the FRU map label on the side of the NVRAM module to determine the locations of DIMM slots 1 and 2.
+

. Remove the DIMM by pressing down on the DIMM locking tabs and lifting the DIMM out of the socket.

. Install the replacement DIMM by aligning the DIMM with the socket and gently pushing the DIMM into the socket until the locking tabs lock in place.
. Install the NVRAM module into the enclosure:
.. Gently slide the module into the slot until the cam latch begins to engage with the I/O cam pin, and then rotate the cam latch all the way up to lock the module in place.
. Rotate the cable management tray up to the closed position.

--

====

// end tabbed area

== Step 3: Reboot the controller

After you replace the FRU, you must reboot the controller module.

. Plug the power cables back into the PSU. 
+
The system will begin to reboot, typically to the LOADER prompt.
+
. Enter `bye` at the LOADER prompt.

== Step 4: Complete NVRAM replacement

Perform the following steps to complete the NVRAM replacement.

.Steps
. From the LOADER prompt on the controller, boot the controller and enter _y_ when prompted to override the system ID due to a system ID mismatch.
+
The following is an example of the prompt for overriding the system ID:
+
----
WARNING: System ID mismatch. This usually occurs when replacing a boot device or NVRAM cards!
Override system ID? {y|n}
----

. From the healthy controller, verify that the new partner system ID has been automatically assigned: 
`_storage failover show_`
+
In the command output, you should see a message displaying the current state of the storage replacement. In the following example, node2 has undergone replacement and displays the current state as "In takeover".
+
----
node1:> storage failover show
                                    Takeover
Node              Partner           Possible     State Description
------------      ------------      --------     -------------------------------------
node1             node2             false        In takeover  
node2             node1             -            Waiting for giveback
----

. Give back the controller:
 .. From the healthy controller, give back the replaced controller's storage:`_storage failover giveback -ofnode replacement_node_name_`
+
The controller takes back its storage and completes booting.
+
NOTE: If the giveback is vetoed, you can consider overriding the vetoes.
+
For more information, see the https://docs.netapp.com/us-en/ontap/high-availability/ha_manual_giveback.html#if-giveback-is-interrupted[Manual giveback commands^] topic to override the veto.

 .. After the giveback has been completed, confirm that the HA pair is healthy and that takeover is possible: _storage failover show_
+
The output from the `storage failover show` command should not include the System ID changed on partner message.

. Verify that the expected volumes are present for each controller:
+ 
`vol show -node node-name`

. Press <enter> when console messages stop.
* If you see the _login_ prompt, go to the next step.
* If you do not see login prompt, log into the partner node.
. Wait 5 minutes after the giveback report completes, and check failover status and giveback status:
+
`storage failover show` and `storage failover show-giveback`
+
NOTE: The following command is only available in the Diagnostic mode privilege level.
. If the HA internconnect links were taken down, bring them back up:
+
`system ha interconnect link on -node healthy-node -link 0`
+
`system ha interconnect link on -node healthy-node -link 1`

. Return the impaired controller to normal operation by giving back its storage:
+
`storage failover giveback -ofnode _impaired_node_name_`

. If automatic giveback was disabled, reenable it:
+ 
`storage failover modify -node local -auto-giveback-of true`

. If AutoSupport is enabled, restore/unsuppress automatic case creation:
+ 
`system node autosupport invoke -node * -type all -message MAINT=END`

== Step 5: Return the failed part to NetApp

include::../_include/complete_rma.adoc[]