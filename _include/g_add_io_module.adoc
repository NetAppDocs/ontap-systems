You can add I/O modules to your storage system by either adding them to available slots or by replacing I/O modules with new ones in a fully-populated storage system.

.Before you begin

* Check the https://hwu.netapp.com/[NetApp Hardware Universe^] to make sure that the new I/O module is compatible with your storage system and version of ONTAP you're running.

* If multiple slots are available, check the slot priorities in https://hwu.netapp.com/[NetApp Hardware Universe^] and use the best one available for your I/O module.

* All other components in the storage system must be functioning properly; if not, you must contact https://mysupport.netapp.com/site/global/dashboard[NetApp Support] before continuing with this procedure.

.About this task
* When adding I/O modules, you add the same module type in each controller. This procedure has you add them one at a time by repeating steps.
* The controller in which you are adding an I/O module is referred to as the _impaired_ controller.
* If needed, you can turn on the storage system location (blue) LEDs to aid in physically locating the affected storage system. Log into the BMC using SSH and enter the `system location-led _on_` command.
+
A storage system has three location LEDs: one on the operator display panel and one on each controller. Location LEDs remain illuminated for 30 minutes. 
+
You can turn them off by entering the `system location-led _off_` command. If you are unsure if the LEDs are on or off, you can check their state by entering the `system location-led show` command.

== Option 1: Add I/O modules to a storage system with available slots

You can add an I/O module into an available slot in each controller.

=== Step 1: Shut down the impaired controller

Shut down or take over the impaired controller.

// Shut down or take over the impaired controller using one of the following options.

// [role="tabbed-block"]
// ====

// .Option 1: Most systems
// --
include::../_include/shutdown_most_frus_no_PCM_remove.adoc[]
// --
// .Option 2: Controller is in a MetroCluster
// --
// include::../_include/shutdown_any_mcc_supported_no_PCM_remove.adoc[]
// --

// ====

=== Step 2: Add I/O modules to available slots

. If you are not already grounded, properly ground yourself. 

. On the impaired controller, remove the I/O blanking module from the target slot.
+
Unused I/O slots should have blanking module installed to prevent possible thermal issues.
+
image::../media/drw_g_io_blanking_module_replace_ieops-1901.svg[Remove an I/O blanking module]
+
[cols="1,4"]
|===
a|
image:../media/icon_round_1.png[Callout number 1]
a|
On the I/O blanking module, turn the thumbscrew counterclockwise to loosen.
a|
image:../media/icon_round_2.png[Callout number 2]
a|
Pull the I/O blanking module out of the controller using the tab on the left and the thumbscrew.

|===

. Install the new I/O module:
.. Align the I/O module with the edges of the controller slot opening.
.. Gently push the I/O module all the way into the slot, making sure to properly seat the module into the connector.
+
You can use the tab on the left and the thumbscrew to push in the I/O Module.
+
.. Turn the thumbscrew clockwise to tighten.
. Cable the I/O module to the designated devices.
+
If you installed a storage I/O module, install and cable your NS224 shelves, as described in https://docs.netapp.com/us-en/ontap-systems/ns224/hot-add-shelf-overview.html[Hot-add workflow^].
+
. Reboot the impaired controller from the LOADER prompt: _bye_
+
This reinitializes the PCIe devices, other components, and reboots the node.
+
. Give back the impaired controller from the partner controller: `storage failover giveback -ofnode _impaired_node_name_`.
// This is used in internal FRU docs: Return the impaired controller to normal operation by giving back its storage: `storage failover giveback -ofnode _impaired_node_name_`.

. Repeat these steps for the other controller.

. Restore automatic giveback from the console of the healthy controller if you disabled it: `storage failover modify -node local -auto-giveback true`.

. If AutoSupport is enabled, restore/unsuppress automatic case creation: `system node autosupport invoke -node * -type all -message MAINT=END`.


== Option 2: Add I/O modules in a storage system with no available slots

You can add I/O modules to a fully-populated storage system by removing existing I/O modules and replacing them with different I/O modules.

. If you are:
+
[options="header" cols="1,2"]

|===
| Replacing a...| Then...
a|
NIC I/O module with the same number of ports
a|
The LIFs will automatically migrate when its controller is shut down.
a|
NIC I/O module with fewer ports
a|
Permanently reassign the ASAected LIFs to a different home port. See https://docs.netapp.com/ontap-9/topic/com.netapp.doc.onc-sm-help-960/GUID-208BB0B8-3F84-466D-9F4F-6E1542A2BE7D.html[Migrating a LIF^] for information about using System Manager to permanently move the LIFs.
a|
NIC I/O module with a storage I/O module
a|
Use System Manager to permanently migrate the LIFs to different home ports, as described in https://docs.netapp.com/ontap-9/topic/com.netapp.doc.onc-sm-help-960/GUID-208BB0B8-3F84-466D-9F4F-6E1542A2BE7D.html[Migrating a LIF^].
|===

=== Step 1: Shut down the impaired controller

Shut down or take over the impaired controller.

// Shut down or take over the impaired controller using one of the following options.

// [role="tabbed-block"]
// ====

// .Option 1: Most systems
// --
include::../_include/shutdown_most_frus_no_PCM_remove.adoc[]
// --
// .Option 2: Controller is in a MetroCluster
// --
// include::../_include/shutdown_any_mcc_supported_no_PCM_remove.adoc[]
// --

// ====

=== Step 2: Add I/O modules to unavailable slots

. If you are not already grounded, properly ground yourself. 

. On the impaired controller, unplug any cabling on the target I/O module.

. Remove the target I/O module from the controller:

+
image::../media/drw_g_io_module_replace_ieops-1900.svg[Remove an I/O module]
+
[cols="1,4"]
|===
a|
image:../media/icon_round_1.png[Callout number 1]
a|
Turn the I/O module thumbscrew counterclockwise to loosen.
a|
image:../media/icon_round_2.png[Callout number 2]
a|
Pull the I/O module out of the controller using the port label tab on the left and the thumbscrew.

|===

+
. Install the new I/O module into the target slot:
.. Align the I/O module with the edges of the slot.
.. Gently push the I/O module all the way into the slot, making sure to properly seat the module into the connector.
+
You can use the tab on the left and the thumbscrew to push in the I/O Module.
+
.. Turn the thumbscrew clockwise to tighten.
. Cable the I/O module to the designated devices.

. Repeat the remove and install steps to add any additional I/O modules in the controller.

. Reboot the controller and check the BMC firmware version:
.. From the LOADER prompt, reboot the controller:_bye_
.. Check the version of BMC on the controller: _system service-processor show_
.. Update the BMC firmware if needed: _system service-processor image update_
.. Reboot the controller: _bye_
+
This reinitializes the PCIe devices, other components, and reboots the node.
+
NOTE: If you encounter an issue during reboot, see https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1494308[BURT 1494308 - Environment shutdown might be triggered during I/O module replacement]

. Give back the impaired controller from the partner controller: `storage failover giveback -ofnode _impaired_node_name_`.
// This is used in internal FRU docs: Return the impaired controller to normal operation by giving back its storage: `storage failover giveback -ofnode _impaired_node_name_`.

. Restore automatic giveback from the console of the healthy controller if you disabled it: `storage failover modify -node local -auto-giveback true`.

. The next step depends on what type of I/O module you added:
+
[options="header" cols="1,2"]
|===
| If the I/O module is a...| Then...
a|
NIC module
a|
Use the `storage port modify -node *_<node name>__ -port *_<port name>__ -mode network` command for each port.
a|
Storage module
a|
Install and cable your NS224 shelves, as described in
https://docs.netapp.com/us-en/ontap-systems/ns224/hot-add-shelf-overview.html[Hot-add workflow^].
a|
+
|===

. Repeat these steps for the other controller.